<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Friend Finder</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

  <style>
    body { padding: 70px 30px 30px 30px;}
  </style>  
</head>
<body>
  
  <header>
    <!-- Fixed navbar -->
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
      <a class="navbar-brand" href="#">Friend Finder</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarCollapse">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item">
            <a class="nav-link" href="/">Home </a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="/survey">Survey<span class="sr-only">(current)</span></a>
          </li> 
         <li class="nav-item">
            <a class="nav-link" href="/api/friends">API Friends List</a>
          </li>
        </ul>
      </div>
    </nav>
  </header>

  <form>
    <h3>Tell us some of the basics...</h3>
    <div class="form-group col-auto">
      <label for="name">* Name</label>
      <input type="text" class="form-control" id="name" placeholder="John Smith">
    </div>
    <div class="form-group col-auto">
      <label for="email">* Email Address</label>
      <input type="email" class="form-control" id="email" placeholder="name@example.com">
      <small id="emailHelpBlock" class="form-text text-muted">
        Please enter a valid email address so you can receive notifications about your perfect match!
      </small>
    </div>
    <div class="form-group col-auto">
      <label for="photo">* Link to Photo Image</label>
      <input type="text" class="form-control" id="photo" placeholder="www.facebook.com/myPic.jpg">
    </div>
    <small id="requiredHelpBlock" class="form-text text-muted col-auto">
      * Indicates a required field
    </small>
    <br>
    <h3>Tell us something a little more personal...</h3>
    <div class="form-group ml-0 col-6">
      <label for="q1">Question 1</label>
      <select class="form-control" id="q1">
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
      </select>
    </div>

    <div class="form-group ml-0 col-6">
      <label for="q2">Question 2</label>
      <select class="form-control" id="q2">
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
      </select>
    </div>

    <div class="form-group ml-0 col-6">
      <label for="q3">Question 3</label>
      <select class="form-control" id="q3">
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
      </select>
    </div>

    <div class="form-group ml-0 col-6">
      <label for="q4">Question 4</label>
      <select class="form-control" id="q4">
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
      </select>
    </div>

    <div class="form-group ml-0 col-6">
      <label for="q5">Question 5</label>
      <select class="form-control" id="q5">
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
      </select>
    </div>

    <div class="form-group ml-0 col-6">
      <label for="q6">Question 6</label>
      <select class="form-control" id="q6">
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
      </select>
    </div>

    <div class="form-group ml-0 col-6">
      <label for="q7">Question 7</label>
      <select class="form-control" id="q7">
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
      </select>
    </div>

    <div class="form-group ml-0 col-6">
      <label for="q8">Question 8</label>
      <select class="form-control" id="q8">
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
      </select>
    </div>

    <div class="form-group ml-0 col-6">
      <label for="q9">Question 9</label>
      <select class="form-control" id="q9">
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
      </select>
    </div>

    <div class="form-group ml-0 col-6">
      <label for="q10">Question 10</label>
      <select class="form-control" id="q10">
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
      </select>
    </div>
      
    <br>
    
  </form>
  
  <div class="container text-center">
    <button type="button" class="btn btn-primary btn-lg px-5" id='submit' data-toggle="modal" data-target="#matchModal">Submit!</button>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="matchModal" tabindex="-1" role="dialog" aria-labelledby="matchModalTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="matchModalTitle">Meet your new Friend!</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <h2 id='match-name'></h2>
          <img id="match-img" alt="friend Pic" >
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>






<!-- Bootstrap Components -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>

<script type="text/javascript">
  $("#submit").on("click", function(event) {
    event.preventDefault();
    let surveyRes = [];
    surveyRes.push(
      parseFloat($("#q1").val()), 
      parseFloat($("#q2").val()), 
      parseFloat($("#q3").val()), 
      parseFloat($("#q4").val()), 
      parseFloat($("#q5").val()), 
      parseFloat($("#q6").val()), 
      parseFloat($("#q7").val()), 
      parseFloat($("#q8").val()), 
      parseFloat($("#q9").val()), 
      parseFloat($("#q10").val())
    ); 

    let newFriend = {
      name: $("#name").val().trim(),
      email: $("#email").val().trim(),
      photo: $("#photo").val().trim(),
      surveyData: surveyRes
    };

    console.log(newFriend); 

    // newFriend.name.replace(/\s+/g, "").toLowerCase()
    let currentURL = window.location.origin; 

    // $.post(currentURL + '/api/friends', newFriend, function(data) {
    //   $("#name").val(''); 
    //   $("#email").val('');
    //   $("#phonenumber").val('');
    // })

    friendFinder(newFriend); 

    $.post("/api/friends", newFriend, function(data) {
      $("#name").val(''); 
      $("#email").val('');
      $("#phonenumber").val('');
    })



  });

  // Friend Finder Logic =========================================
  function friendFinder(newFriend) {
    // need to add GET to pull from friendsData
    $.get("/api/friends", function(res) {

    
      // may need to go inside of submit function
      // change friendsData to res and newUser to newFriend
      
      // let newUser = friendsData[friendsData.length -1].surveyData; 
      // console.log(newFriend); 
      let matchTotals = [];
      let bestMatch; 
      let bestMatchIndex; 

      for (let i = 0; i < res.length; i++) {
        let matchArr =[];
        let totals = 0;
        for (let x =0; x < 10; x++) { 
          matchArr.push(Math.abs(newFriend.surveyData[x] - res[i].surveyData[x])); 
          // console.log(newFriend.surveyData[x],  res[i].surveyData[x]); /////
        }

        matchArr.forEach(score => {
          totals += score; 
        })

        // console.log(i +' '+ matchArr +' '+ totals); 

        let tempArr = []; 
        tempArr.push(i, totals); 
        matchTotals.push(tempArr); 
        // console.log(matchTotals); 

        bestMatch = matchTotals.sort(function(a, b){
          return b[1] > a[1] ? -1 : 1; 
        });
        
        bestMatchIndex = parseFloat(bestMatch[0][0]);
      }

      let newFriendMatch = {
        name: res[bestMatchIndex].name,
        email: res[bestMatchIndex].email,
        photo: res[bestMatchIndex].photo
      }; 

      console.log(newFriendMatch); 

      // console.warn(bestMatch); 
      // console.warn(bestMatch[0][0]); ///////////////////////////
      // console.warn(res[bestMatchIndex1].name); 

      $('#match-name').text(newFriendMatch.name); 
      $('#match-img').attr('src', newFriendMatch.photo); 

    }); // end GET
  }; 



</script>


</body>
</html>